jQuery(function(o){"undefined"!=typeof worldpay_payment_methods_params&&(methods={gateways:{},vars:worldpay_payment_methods_params,container:".worldpay-gateway-container",token_selector:".worldpay-payment-token",new_method_container:".worldpay-new-method-container",saved_method_container:".worldpay-saved-methods-container",init:function(){this.init_data_worldpay_attribs(),o(document.body).on("updated_checkout",this.updated_checkout),o(document.body).on("change",".worldpay-saved-cards",this.change_payment_method),o(document.body).on("click",".wc-worldpay-payment-type",this.display_payment_container),this.setup_dropdown(),o(document.body).on("payment_method_selected",this.payment_method_selected),o(document.body).on("click",'input[name="payment_method"]',this.payment_method_selected)},init_data_worldpay_attribs:function(){this.data_attribs={},o.each(this.vars.gateways,function(t,a){$container=o("li.payment_method_"+a),methods.data_attribs[a]={new_method:[],saved_method:[]};var e=$container.find(".worldpay-new-method-container [data-worldpay]");o.each(e,function(t,e){methods.data_attribs[a].new_method.push({id:"#"+o(e).attr("id"),attr:o(e).attr("data-worldpay")})});e=$container.find(".worldpay-saved-methods-container [data-worldpay]");o.each(e,function(t,e){methods.data_attribs[a].saved_method.push({id:"#"+o(e).attr("id"),attr:o(e).attr("data-worldpay")})})}),methods.prepare_form_attribs()},prepare_form_attribs:function(){methods.update_worldpay_attributes()},display_payment_container:function(t){methods.update_worldpay_attributes(),"token"===o(this).val()?o(this).closest(methods.container).find(methods.new_method_container).slideUp(400,function(){o(this).closest(methods.container).find(methods.saved_method_container).slideDown(400),o(document.body).triggerHandler("worldpay_saved_method_selected",o('[name="payment_method"]:checked').val())}):o(this).closest(methods.container).find(methods.saved_method_container).slideUp(400,function(){o(this).closest(methods.container).find(methods.new_method_container).slideDown(400),o(document.body).triggerHandler("worldpay_new_method_selected",o('[name="payment_method"]:checked').val())})},updated_checkout:function(){methods.setup_dropdown(),methods.prepare_form_attribs()},get_selected_gateway_container:function(){var t=o('input[name="payment_method"]:checked').val();return o("li.payment_method_"+t)},setup_dropdown:function(){o().select2&&o(".worldpay-saved-cards").length&&(o(".worldpay-saved-cards:not(.select2-hidden-accessible)").select2({width:"100%",templateResult:methods.output_template,templateSelection:methods.output_template}),o(".worldpay-saved-cards").trigger("change"))},change_payment_method:function(t){o(this).closest(methods.container).find(methods.token_selector).val(o(this).val()),o(document.body).triggerHandler("worldpay_payment_method_changed",o(this).val())},payment_method_selected:function(t){o(document.body).trigger("worldpay_payment_method_selected"),methods.update_worldpay_attributes()},update_worldpay_attributes:function(t){var e=o('input[name="payment_method"]:checked').val();o("[data-worldpay]").removeAttr("data-worldpay");var a=o('[name="'+e+'_payment_type_key"]:checked');if(methods.data_attribs[e]){if(a.length&&"nonce"!==a.val())d=methods.data_attribs[e].saved_method;else var d=methods.data_attribs[e].new_method;o.each(d,function(t,e){o(e.id).attr("data-worldpay",e.attr)})}},output_template:function(t,e){var a=o(t.element).data("card-type"),d="";return a&&(o(e).addClass("worldpay-select2-container"),d=methods.vars.cards[a]),o.parseHTML(d+t.text)}},methods.init())});