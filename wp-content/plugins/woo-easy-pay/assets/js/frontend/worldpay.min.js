! function (w) {
    var Worldpay = Worldpay || {
            api_path: "https://api.worldpay.com/v1/",
            templates_path: "https://online.worldpay.com/templates/",
            clientKey: "",
            templateCode: !1,
            token: "",
            reusable: !1,
            cvc: !0,
            timeout: 10,
            currencyCode: "EUR",
            validationType: "advanced",
            templateSaveButton: !0,
            templateOptions: {
                addedText: "Payment details added",
                addedTextCVC: "CVC added",
                enterCardDetailsButton: "Enter card details",
                iframeOverlay: "position: absolute;top: 0px;bottom: 0px;left: 0px;right: 0px;background-color: #000;-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';filter: alpha(opacity=80);-moz-opacity: 0.8;-khtml-opacity: 0.8;opacity: 0.8;",
                iframeClose: "position: absolute;top: 100px;height: 20px;width: 20px;right: -350px;text-decoration: none;margin-right: 50%;cursor: pointer;z-index: 999;color: #000;font-size: 16px;font-weight: bold;text-align: center;",
                iframeHolderInline: "position: relative;top: 0px;background-color: #fff;border:none;",
                iframeHolderModal: "position: absolute;top: 100px;left: -350px;background-color: #fff;width: 220px;height: 220px;margin-left: 50%;border:none;",
                dimensions: {
                    width: !1,
                    height: !1
                },
                images: {
                    enabled: !0
                },
                autofocus: !1,
                formatCardNumber: !0
            },
            displayType: "ownForm",
            templateType: "card",
            invalidClientKey: !1,
            tokenType: "card",
            callbacks: {
                beforeSubmit: function () {
                    return !0
                },
                validationError: function () {}
            },
            templateFormVisible: !1,
            debug: !1
        },
        defaultCardFormat = /(\d{1,4})/g,
        cardSettings = [{
            type: "amex",
            pattern: /^3[47]/,
            format: /(\d{1,4})(\d{1,6})?(\d{1,5})?/,
            length: [15],
            cvcLength: [4],
            luhn: !0
        }, {
            type: "dankort",
            pattern: /^5019/,
            format: defaultCardFormat,
            length: [16],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "dinersclub",
            pattern: /^(36|38|30[0-5])/,
            format: defaultCardFormat,
            length: [14],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "discover",
            pattern: /^(6011|65|64[4-9]|622)/,
            format: defaultCardFormat,
            length: [16],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "jcb",
            pattern: /^35/,
            format: defaultCardFormat,
            length: [16],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "laser",
            pattern: /^(6706|6771|6709)/,
            format: defaultCardFormat,
            length: [16, 17, 18, 19],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "maestro",
            pattern: /^(5018|5020|5038|6304|6703|6759|676[1-3])/,
            format: defaultCardFormat,
            length: [12, 13, 14, 15, 16, 17, 18, 19],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "mastercard",
            pattern: /^5[1-5]/,
            format: defaultCardFormat,
            length: [16],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "unionpay",
            pattern: /^62/,
            format: defaultCardFormat,
            length: [16, 17, 18, 19],
            cvcLength: [3],
            luhn: !1
        }, {
            type: "visaelectron",
            pattern: /^4(026|17500|405|508|844|91[37])/,
            format: defaultCardFormat,
            length: [16],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "elo",
            pattern: /^4011|438935|45(1416|76)|50(4175|6699|67|90[4-7])|63(6297|6368)/,
            format: defaultCardFormat,
            length: [16],
            cvcLength: [3],
            luhn: !0
        }, {
            type: "visa",
            pattern: /^4/,
            format: defaultCardFormat,
            length: [13, 16],
            cvcLength: [3],
            luhn: !0
        }],
        defaultTemplateDimensions = {
            width: 220,
            height: 220
        };
    Worldpay.useOwnForm = function (e) {
        Worldpay.form.useOwnForm(e)
    }, Worldpay.useForm = function (e, t, r) {
        Worldpay.form.useOwnForm({
            form: e,
            callback: t,
            useReusableToken: r
        })
    }, Worldpay.useTemplateForm = function (e) {
        Worldpay.template.useTemplateForm(e)
    }, Worldpay.useTemplate = function (e, t, r, a) {
        Worldpay.template.useTemplateForm({
            form: e,
            paymentSection: t,
            display: r,
            callback: a
        })
    }, Worldpay.submitTemplateForm = function () {
        Worldpay.template.submitTemplateForm()
    }, Worldpay.getTemplateToken = function () {
        Worldpay.template.getTemplateToken()
    }, Worldpay.closeTemplateModal = function () {
        return Worldpay.template.closeTemplateModal()
    }, Worldpay.checkTemplateForm = function (e) {
        return Worldpay.template.checkTemplateForm(e)
    }, Worldpay.recalculateTemplateDimensions = function () {
        Worldpay.template.recalculateDimensions()
    }, Worldpay.setTemplateDimensions = function (e) {
        return e && e.height && e.width ? void Worldpay.template.changeTemplateDimensions(e) : void Worldpay.helpers.outputDevError("Worldpay.setTemplateDimensions No object found", "TD01")
    }, Worldpay.setClientKey = function (e) {
        this.clientKey = e
    }, Worldpay.setTemplate = function (e) {
        this.templateCode = e
    }, Worldpay.setReusable = function (e) {
        this.reusable = !!e
    }, Worldpay.setCVC = function (e) {
        this.cvc = !!e
    }, Worldpay.setValidationType = function (e) {
        this.validationType = "basic" == e || "advanced" == e ? e : "advanced"
    }, Worldpay.setTemplateOptions = function (e) {
        e.addedText && (Worldpay.templateOptions.addedText = e.addedText), e.addedTextCVC && (Worldpay.templateOptions.addedTextCVC = e.addedTextCVC), e.enterCardDetailsButton && (Worldpay.templateOptions.enterCardDetailsButton = e.enterCardDetailsButton), e.iframeOverlay && (Worldpay.templateOptions.iframeOverlay = e.iframeOverlay), e.iframeHolderInline && (Worldpay.templateOptions.iframeHolderInline = e.iframeHolderInline), e.iframeHolderModal && (Worldpay.templateOptions.iframeHolderModal = e.iframeHolderModal), e.dimensions && (Worldpay.templateOptions.dimensions = e.dimensions), e.dimensions && (Worldpay.templateOptions.dimensions = e.dimensions), e.images && (Worldpay.templateOptions.images = e.images), e.autofocus && (Worldpay.templateOptions.autofocus = e.autofocus)
    }, Worldpay.setDebugMode = function (e) {
        this.debug = e
    }, Worldpay.createAPMToken = function (e) {
        Worldpay.apm.createTokenFromObject(e)
    }, Worldpay.handleError = function (e, t, r) {
        if (!t) return !1;
        if (r.message && (r = r.message), null != r) {
            "string" == typeof r ? t.innerHTML = Worldpay.helpers.capitaliseFirstLetter(r) : "object" == typeof r && 0 < r.length && (t.innerHTML = r.join("<br/>"));
            for (var a = 0; a < e.length; a++)("button" === e[a].type || "submit" === e[a].type) && (e[a].disabled = !1)
        }
    }, Worldpay.formBuilder = function (e, t, r, a, o, l) {
        var n = document.createElement(t);
        n.type = r, n.name = a, n.id = l || a, n.value = o, e.appendChild(n)
    }, Worldpay.form = {}, Worldpay.form.useOwnForm = function (e) {
        var r = !1,
            a = !1,
            o = !1,
            l = !1;
        e.form && (r = Worldpay.helpers.getElement(e.form, "FORM")), e.callback && (a = e.callback), e.useReusableToken && (o = e.useReusableToken), e.clientKey && Worldpay.setClientKey(e.clientKey), e.beforeSubmit && (Worldpay.callbacks.beforeSubmit = e.beforeSubmit), e.reusable && Worldpay.setReusable(!!e.reusable), e.cvc && (l = e.cvc, Worldpay.templateType = "cvc");
        for (var n = {}, t = 0; t < r.length; t++) r[t].getAttribute("data-worldpay") && (n[r[t].getAttribute("data-worldpay")] = r[t]);
        if (e.formatCardNumber && "card" == Worldpay.templateType) {
            if (!n.number) return console.log("WorldpayJS: Cannot find number - clkno"), !1;
            Worldpay.helpers.on(n.number, "keypress", Worldpay.helpers.restrictNumeric), Worldpay.helpers.on(n.number, "keypress", Worldpay.card.restrictCardNumber), Worldpay.helpers.on(n.number, "keypress", Worldpay.card.formatCardNumber), Worldpay.helpers.on(n.number, "keydown", Worldpay.card.formatBackCardNumber), Worldpay.helpers.on(n.number, "paste", Worldpay.card.reFormatCardNumber), Worldpay.helpers.on(n.cvc, "keypress", Worldpay.helpers.restrictNumeric), n["exp-month"] && "text" == n["exp-month"].type ? (Worldpay.helpers.on(n["exp-month"], "keypress", Worldpay.helpers.restrictNumeric), Worldpay.helpers.on(n["exp-year"], "keypress", Worldpay.helpers.restrictNumeric)) : n["exp-monthyear"] && (Worldpay.helpers.on(n["exp-monthyear"], "keypress", Worldpay.helpers.restrictNumeric), Worldpay.helpers.on(n["exp-monthyear"], "keypress", Worldpay.helpers.restrictCombinedExpiry), Worldpay.helpers.on(n["exp-monthyear"], "keypress", Worldpay.helpers.formatExpiry), Worldpay.helpers.on(n["exp-monthyear"], "keypress", Worldpay.helpers.formatForwardSlash), Worldpay.helpers.on(n["exp-monthyear"], "keypress", Worldpay.helpers.formatForwardExpiry), Worldpay.helpers.on(n["exp-monthyear"], "keydown", Worldpay.helpers.formatBackExpiry))
        } else "cvc" == Worldpay.templateType && Worldpay.helpers.on(n.cvc, "keypress", Worldpay.helpers.restrictNumeric);
        var d = document.getElementById("payment-form");
        for (var u in Worldpay._shouldCheckFields = [], n) Worldpay.helpers.on(n[u], "change", function (e) {
            var t = e.target.getAttribute("data-worldpay");
            "exp-month" == t ? (t = "expiration", null == Worldpay._shouldCheckFields[t] && (Worldpay._shouldCheckFields.expirationmonth = !0)) : "exp-year" == t ? (t = "expiration", null == Worldpay._shouldCheckFields[t] && (Worldpay._shouldCheckFields.expirationyear = !0)) : "exp-monthyear" == t ? (t = "expiration", null == Worldpay._shouldCheckFields[t] && (Worldpay._shouldCheckFields.expirationboth = !0)) : null == Worldpay._shouldCheckFields[t] && (Worldpay._shouldCheckFields[t] = !0), window.Placeholders && d && (window.Placeholders.disable(d), setTimeout(function () {
                for (var e in window.Placeholders.enable(d), n) document.activeElement === n[e] && window.Placeholders.disable(n[e])
            }, 50)), Worldpay.card.createTokenValidate(r, function (e, t) {
                Worldpay.helpers.templateFormCallback(e, t, r)
            })
        });
        return Worldpay.clientKey ? !1 === r ? (Worldpay.helpers.outputDevError("WorldpayJS: No form foun", "f04"), !1) : "function" != typeof a ? (Worldpay.helpers.outputDevError("WorldpayJS: No callback found", "c04"), !1) : void(r.onsubmit = function () {
            if (!Worldpay.callbacks.beforeSubmit()) return !1;
            Worldpay._shouldCheckFields.name = !0, Worldpay._shouldCheckFields.number = !0, Worldpay._shouldCheckFields.expirationboth = !0, Worldpay._shouldCheckFields.cvc = !0;
            var e = document.getElementById("payment-form");
            window.Placeholders && e && (window.Placeholders.disable(e), setTimeout(function () {
                window.Placeholders.enable(e)
            }, 50));
            for (var t = 0; t < r.length; t++)("button" === r[t].type || "submit" === r[t].type) && (Worldpay.displayType, 0 == Worldpay.templateSaveButton && (r[t].disabled = "disabled"));
            return ("inline" == Worldpay.displayType || "modal" == Worldpay.displayType) && (a = function (e, t) {
                Worldpay.helpers.templateFormCallback(e, t, r)
            }), "apm" === Worldpay.tokenType ? Worldpay.apm.createToken(r, a) : 0 != l ? Worldpay.card.updateToken(r, l, a) : null == o || 0 == o ? Worldpay.card.createToken(r, a) : Worldpay.card.reuseToken(r, a), !1
        }) : (Worldpay.helpers.outputDevError("WorldpayJS: No clientKey found", "clk04"), !1)
    }, Worldpay.template = {}, Worldpay.template.messageListener, Worldpay.template.useTemplateForm = function (e) {
        var d = !1,
            t = !1,
            r = !1,
            a = !1,
            u = !1,
            o = (Worldpay.templateSaveButton, !1);
        if (e.form && (d = Worldpay.helpers.getElement(e.form, "FORM")), e.paymentSection && (t = Worldpay.helpers.getElement(e.paymentSection)), e.display && (r = e.display), e.type && (a = e.type), e.callback && (u = e.callback), e.clientKey && Worldpay.setClientKey(e.clientKey), e.beforeSubmit && (Worldpay.callbacks.beforeSubmit = e.beforeSubmit), e.validationError && (Worldpay.callbacks.validationError = e.validationError), e.reusable && Worldpay.setReusable(!!e.reusable), null != e.saveButton && (Worldpay.templateSaveButton = !!e.saveButton), e.templateOptions && Worldpay.setTemplateOptions(e.templateOptions), e.code && (Worldpay.templateCode = e.code), e.token) o = e.token, Worldpay.cvcToken = o;
        else if ("cvc" == a) return Worldpay.helpers.outputDevError("WorldpayJS: No token defined for CVC type", "cvctkn04"), !1;
        if (!Worldpay.clientKey) return Worldpay.helpers.outputDevError("WorldpayJS: No clientKey found", "clk04"), !1;
        if (!1 === d && "function" != typeof u) return Worldpay.helpers.outputDevError("WorldpayJS: No form or callback found", "fc04"), !1;
        if (!1 === t) return Worldpay.helpers.outputDevError("WorldpayJS: No payment section found", "psn04"), !1;
        if (!1 === r) return Worldpay.helpers.outputDevError("WorldpayJS: No display set", "t04"), !1;
        Worldpay.displayType = r = "inline" == r || "modal" == r ? r : "modal", Worldpay.templateType = a = "card" == a || "cvc" == a ? a : "card", !1 !== d && d.setAttribute("onsubmit", "return Worldpay.checkTemplateForm(this)"), "modal" == r ? t.innerHTML = '<div id="token_container"><input type="button" value="' + Worldpay.templateOptions.enterCardDetailsButton + '" id="token_container-button" onclick="Worldpay.getTemplateToken()" /><div id="token_container_holder" style="visibility:hidden"></div></div>' : "inline" == r && (t.innerHTML = '<div id="token_container"><div id="token_container_holder" style="visibility:hidden"></div></div>', Worldpay.getTemplateToken());
        var l = function (e) {
            if (e && e.data) {
                var t = Worldpay.helpers.JSON.parse(e.data);
                Worldpay._dimensions = Worldpay._dimensions || {
                    width: defaultTemplateDimensions.width,
                    height: defaultTemplateDimensions.height
                };
                var r = Worldpay._dimensions;
                if (null != t.token) {
                    var a = document.getElementById("token_container");
                    null != u && 0 != u ? (!1 !== d && d.setAttribute("onsubmit", ""), u(t)) : a.innerHTML = '<div class="token_data_div"><input type="hidden" id="worldpayjs_token" name="token" value="' + t.token + '" />' + Worldpay.templateOptions.addedText + "</div>"
                } else if (null != t.cvc) {
                    a = document.getElementById("token_container");
                    null != u && 0 != u ? (!1 !== d && d.setAttribute("onsubmit", ""), u(t)) : a.innerHTML = ""
                } else if (null != t.errors) Worldpay.callbacks.validationError && Worldpay.callbacks.validationError(t.errors || !1);
                else if (null != t.dimensions) Worldpay.templateOptions.dimensions.width ? r.width = Worldpay.templateOptions.dimensions.width : t.dimensions.width && t.dimensions.width >= defaultTemplateDimensions.width && (r.width = t.dimensions.width), Worldpay.templateOptions.dimensions.height ? r.height = Worldpay.templateOptions.dimensions.height : t.dimensions.height && (r.height = t.dimensions.height);
                else if (null != t.visibility) {
                    var o = document.getElementById("token_container_holder");
                    if (!o) return;
                    o.style.opacity = 0, o.style.filter = "alpha(opacity=0)", o.style.display = "inline-block", o.style.visibility = "visible", Worldpay.templateFormVisible = !0;
                    var l = 0,
                        n = setInterval(function () {
                            1 <= (l += .25) && (clearInterval(n), l = 1), o.style.opacity = l, o.style.filter = "alpha(opacity=" + 100 * l + ")"
                        }, 50)
                }
                document.getElementById("_iframe_holder") && document.getElementById("_iframe_holder").style && (Worldpay.templateOptions.dimensions.width && (r.width = Worldpay.templateOptions.dimensions.width.toString().replace("px", ""), document.getElementById("_iframe_holder").style.width = r.width + "px"), Worldpay.templateOptions.dimensions.height && (r.height = Worldpay.templateOptions.dimensions.height.toString().replace("px", ""), document.getElementById("_iframe_holder").style.height = r.height + "px"), document.getElementById("_iframe_holder").style.width = r.width.toString().replace("px", "") + "px", document.getElementById("_iframe_holder").style.height = r.height.toString().replace("px", "") + "px", null != document.getElementById("_iframe_close") && (document.getElementById("_iframe_holder").style.left = -r.width.toString().replace("px", "") / 2 + "px", document.getElementById("_iframe_close").style.right = -r.width.toString().replace("px", "") / 2 + "px"))
            }
        };
        window.addEventListener ? (window.removeEventListener("message", Worldpay.template.messageListener, !1), window.addEventListener("message", l, !1)) : (window.detachEvent("onmessage", Worldpay.template.messageListener, !1), window.attachEvent("onmessage", l, !1)), Worldpay.template.messageListener = l
    }, Worldpay.template.submitTemplateForm = function () {
        return !!Worldpay.callbacks.beforeSubmit() && void Worldpay.template.sendMessage(Worldpay.helpers.JSON.stringify({
            submit: !0
        }))
    }, Worldpay.template.getTemplateToken = function () {
        if ("modal" == Worldpay.displayType) {
            document.getElementById("token_container_holder").innerHTML = '<div id="_iframe_overlay" style="' + Worldpay.templateOptions.iframeOverlay + '"></div><a id="_iframe_close" onclick="Worldpay.closeTemplateModal()" href="javascript:;" style="' + Worldpay.templateOptions.iframeClose + '">&times;</a><iframe id="_iframe_holder" scrolling="no" style="' + Worldpay.templateOptions.iframeHolderModal + '" marginheight="0" marginwidth="0" frameborder="0"></iframe>';
            var e = setInterval(function () {
                    document.getElementById("_iframe_overlay").style.webkitTransform = "scale(0.9999999)"
                }, 1),
                t = setInterval(function () {
                    document.getElementById("_iframe_overlay").style.webkitTransform = "scale(1)"
                }, 5);
            setTimeout(function () {
                clearInterval(e), clearInterval(t)
            }, 5e3)
        } else if ("inline" == Worldpay.displayType) {
            document.getElementById("token_container_holder").innerHTML = '<iframe id="_iframe_holder" scrolling="no" style="' + Worldpay.templateOptions.iframeHolderInline + '" marginheight="0" marginwidth="0" frameborder="0"></iframe>'
        }
        var r = Worldpay.templates_path,
            a = document.getElementById("_iframe_holder"),
            o = a.contentWindow || a.contentDocument;
        if (o.document && (o = o.document), "modal" == Worldpay.displayType) o.write('<body><form action="' + r + '" method="POST" id="iframepost"><input type="hidden" name="clientKey" value="' + Worldpay.clientKey + '" /><input type="hidden" name="templateType" value="' + Worldpay.templateType + '" /><input type="hidden" name="cvc" value="' + Worldpay.cvc + '" /><input type="hidden" name="reusable" value="' + Worldpay.reusable + '" /><input type="hidden" name="cvcToken" value="' + (Worldpay.cvcToken || !1) + '" /><input type="hidden" name="displayType" value="modal" /><input type="hidden" name="button" value="Save" /><input type="hidden" name="templateCode" value="' + (Worldpay.templateCode || 0) + '" /><input type="hidden" name="images" value="' + Worldpay.templateOptions.images.enabled + '" /><input type="hidden" name="autofocus" value="' + Worldpay.templateOptions.autofocus + '" /></form></body>');
        else if ("inline" == Worldpay.displayType) {
            var l = "";
            (0 != Worldpay.templateOptions.dimensions.width || 0 != Worldpay.templateOptions.dimensions.height) && (l = "w:" + Worldpay.templateOptions.dimensions.width + ",h:" + Worldpay.templateOptions.dimensions.height), o.write('<body><form action="' + r + '" method="POST" id="iframepost"><input type="hidden" name="clientKey" value="' + Worldpay.clientKey + '" /><input type="hidden" name="templateType" value="' + Worldpay.templateType + '" /><input type="hidden" name="cvc" value="' + Worldpay.cvc + '" /><input type="hidden" name="reusable" value="' + Worldpay.reusable + '" /><input type="hidden" name="cvcToken" value="' + (Worldpay.cvcToken || !1) + '" /><input type="hidden" name="displayType" value="inline" /><input type="hidden" name="button" value="Save" /><input type="hidden" name="templateCode" value="' + (Worldpay.templateCode || 0) + '" /><input type="hidden" name="templateSaveButton" value="' + Worldpay.templateSaveButton + '" /><input type="hidden" name="templateDimensions" value="' + l + '" /><input type="hidden" name="images" value="' + Worldpay.templateOptions.images.enabled + '" /><input type="hidden" name="autofocus" value="' + Worldpay.templateOptions.autofocus + '" /></form></body>')
        }
        Worldpay.templateFormVisible = !1, a.onload = Worldpay.template.formLoaded, o.getElementById("iframepost").submit()
    }, Worldpay.template.closeTemplateModal = function () {
        var e = document.getElementById("token_container_holder");
        if (e) {
            var t = 1,
                r = setInterval(function () {
                    (t -= 50 / 300) <= 0 && (clearInterval(r), t = 0, e.style.display = "none", e.style.visibility = "hidden"), e.style.opacity = t, e.style.filter = "alpha(opacity=" + 100 * t + ")"
                }, 50)
        }
    }, Worldpay.template.checkTemplateForm = function (e) {
        return null != e.token
    }, Worldpay.template.formLoaded = function () {
        Worldpay.templateFormVisible || setTimeout(function () {
            Worldpay.templateFormVisible || (window.postMessage(Worldpay.helpers.JSON.stringify({
                visibility: !0
            }), "*"), window.postMessage(Worldpay.helpers.JSON.stringify({
                dimensions: {
                    width: "520",
                    height: "400"
                }
            }), "*"))
        }, 5e3)
    }, Worldpay.template.sendMessage = function (e) {
        var t = document.getElementById("_iframe_holder");
        (t.contentWindow || t.contentDocument).postMessage(e, "*")
    }, Worldpay.template.recalculateDimensions = function () {
        window.postMessage(Worldpay.helpers.JSON.stringify({
            dimensions: {
                width: defaultTemplateDimensions.width,
                height: defaultTemplateDimensions.height
            }
        }), "*"), Worldpay.template.sendMessage(Worldpay.helpers.JSON.stringify({
            recalculateDimensions: !0
        }))
    }, Worldpay.template.changeTemplateDimensions = function (e) {
        window.postMessage(Worldpay.helpers.JSON.stringify({
            dimensions: {
                width: e.width,
                height: e.height
            }
        }), "*")
    }, Worldpay.helpers = {}, Worldpay.helpers.getElement = function (e, t) {
        if ("" != e && null != e) {
            if (e && e.tagName && (!t || t && e.tagName == t)) return e;
            var r = document.getElementById(e);
            if (r && r.tagName && (!t || t && r.tagName == t)) return document.getElementById(e);
            if (e[0] && e[0].tagName && (!t || t && e[0].tagName == t)) return e[0]
        }
        return !1
    }, Worldpay.helpers.deleteFunction = function (t) {
        try {
            delete w[t]
        } catch (e) {
            w[t] = void 0
        }
    }, Worldpay.helpers.getEl = function (e) {
        return "string" == typeof e && (e = document.getElementById(e)), e
    }, Worldpay.helpers.collect = function (e, t) {
        for (var r = [], a = 0; a < e.length; a++) {
            var o = t(e[a]);
            null !== o && r.push(o)
        }
        return r
    }, Worldpay.helpers.createErrorResponse = function (e) {
        var t = {
            error: {
                message: "",
                object: []
            }
        };
        if (e.length) {
            t.error.object = e;
            for (var r = [], a = 0; a < e.length; a++)
                for (var o in e[a]) r.push(e[a][o]);
            r.join("<br/>"), t.error.message = r
        }
        return t
    };
    var isEmptyError = function (e) {
            return "object" == typeof e && null != e.object && 0 == e.object.length
        },
        isSuccessfulResponse = function (e) {
            return !e.error || isEmptyError(e.error)
        };
    Worldpay.helpers.templateFormCallback = function (e, t, r) {
        var a = "_error",
            o = Worldpay.helpers.removeClass,
            l = Worldpay.helpers.addClass,
            n = n || null;
        document.getElementById("_el_error_nameoncard") && (document.getElementById("_el_error_nameoncard").style.display = "none", document.getElementById("_el_input_nameoncard") && (o(document.getElementById("_el_input_nameoncard").firstChild, a), document.getElementById("_el_label_nameoncard") && o(document.getElementById("_el_label_nameoncard").firstChild, a))), document.getElementById("_el_error_cardnumber") && (document.getElementById("_el_error_cardnumber").style.display = "none", document.getElementById("_el_input_cardnumber") && (o(document.getElementById("_el_input_cardnumber").firstChild, a), document.getElementById("_el_label_cardnumber") && o(document.getElementById("_el_label_cardnumber").firstChild, a), o(document.getElementById("_el_error_cardnumber").firstChild, a))), document.getElementById("_el_error_expiration") && (document.getElementById("_el_error_expiration").style.display = "none", document.getElementById("_el_input_expirationmonth") && o(document.getElementById("_el_input_expirationmonth").firstChild, a), document.getElementById("_el_input_expirationyear") && o(document.getElementById("_el_input_expirationyear").firstChild, a), document.getElementById("_el_input_expirationmonth_dd") && o(document.getElementById("_el_input_expirationmonth_dd").firstChild, a), document.getElementById("_el_input_expirationyear_dd") && o(document.getElementById("_el_input_expirationyear_dd").firstChild, a), document.getElementById("_el_input_expirationboth") && o(document.getElementById("_el_input_expirationboth").firstChild, a), document.getElementById("_el_label_expiration") && o(document.getElementById("_el_label_expiration").firstChild, a)), document.getElementById("_el_error_cvc") && (document.getElementById("_el_error_cvc").style.display = "none", document.getElementById("_el_input_cvc") && (o(document.getElementById("_el_input_cvc").firstChild, a), document.getElementById("_el_label_cvc") && o(document.getElementById("_el_label_cvc").firstChild, a))), document.getElementById("payment-errors") && (document.getElementById("payment-errors").style.display = "none");
        var d = function (e) {
            document.getElementById("payment-errors") && (document.getElementById("payment-errors").style.display = "block", document.getElementById("payment-errors").innerHTML = e)
        };
        if (isSuccessfulResponse(t))
            if (t.error);
            else if (t.token) {
            var u = t.token;
            Worldpay.formBuilder(r, "input", "hidden", "token", u), window.parent.postMessage(Worldpay.helpers.JSON.stringify(t), "*")
        } else "cvc" == Worldpay.templateType && window.parent.postMessage(Worldpay.helpers.JSON.stringify({
            cvc: !0,
            status: e,
            response: t
        }), "*");
        else {
            if ("object" == typeof t.error)
                if ("BAD_REQUEST" == t.error.customCode) {
                    if (Worldpay.handleError(r, document.getElementById("payment-errors"), t.error.message), document.getElementById("_el_error_cvc") && (document.getElementById("_el_error_cvc").style.display = "block", document.getElementById("_el_input_cvc") && l(document.getElementById("_el_input_cvc").firstChild, a), n)) {
                        if (document.getElementById("_el_label_cvc")) var i = (_ = document.getElementById("_el_label_cvc")).offsetTop + _.getBoundingClientRect().height / 2;
                        if (document.getElementById("_el_error_cvc"))(C = document.getElementById("_el_error_cvc")).style.setProperty("top", Math.abs(parseFloat(i) - parseFloat(C.getBoundingClientRect().height / 2)) + "px", "important")
                    }
                } else if (t.error.object)
                for (var p in t.error.object)
                    for (var s in t.error.object[p])
                        if ("nameoncard" == s && Worldpay._shouldCheckFields.name) {
                            if (document.getElementById("_el_error_nameoncard") && (document.getElementById("_el_error_nameoncard").style.display = "block"), document.getElementById("_el_input_nameoncard") && (l(document.getElementById("_el_input_nameoncard").firstChild, a), document.getElementById("_el_label_nameoncard") && l(document.getElementById("_el_label_nameoncard").firstChild, a), document.getElementById("_el_error_nameoncard") && l(document.getElementById("_el_error_nameoncard").firstChild, a)), n) {
                                if (document.getElementById("_el_label_nameoncard")) var c = document.getElementById("_el_label_nameoncard"),
                                    m = c.offsetTop + c.getBoundingClientRect().height / 2;
                                if (document.getElementById("_el_error_nameoncard")) {
                                    var y = document.getElementById("_el_error_nameoncard");
                                    y.style.setProperty("top", Math.abs(parseFloat(m) - parseFloat(y.getBoundingClientRect().height / 2)) + "px", "important")
                                }
                            }
                        } else if ("cardnumber" == s && Worldpay._shouldCheckFields.number) {
                if (document.getElementById("_el_error_cardnumber") && (document.getElementById("_el_error_cardnumber").style.display = "block"), document.getElementById("_el_input_cardnumber") && (l(document.getElementById("_el_input_cardnumber").firstChild, a), document.getElementById("_el_label_cardnumber") && l(document.getElementById("_el_label_cardnumber").firstChild, a), document.getElementById("_el_error_cardnumber") && l(document.getElementById("_el_error_cardnumber").firstChild, a)), n) {
                    if (document.getElementById("_el_label_cardnumber")) var h = document.getElementById("_el_label_cardnumber"),
                        f = h.offsetTop + h.getBoundingClientRect().height / 2;
                    if (document.getElementById("_el_error_cardnumber")) {
                        var g = document.getElementById("_el_error_cardnumber");
                        g.style.setProperty("top", Math.abs(parseFloat(f) - parseFloat(g.getBoundingClientRect().height / 2)) + "px", "important")
                    }
                }
            } else if ("expiration" == s && (Worldpay._shouldCheckFields.expirationboth || Worldpay._shouldCheckFields.expirationmonth && Worldpay._shouldCheckFields.expirationyear)) {
                if (document.getElementById("_el_error_expiration") && (document.getElementById("_el_error_expiration").style.display = "block"), document.getElementById("_el_input_expirationmonth") && l(document.getElementById("_el_input_expirationmonth").firstChild, a), document.getElementById("_el_input_expirationyear") && l(document.getElementById("_el_input_expirationyear").firstChild, a), document.getElementById("_el_input_expirationmonth_dd") && l(document.getElementById("_el_input_expirationmonth_dd").firstChild, a), document.getElementById("_el_input_expirationyear_dd") && l(document.getElementById("_el_input_expirationyear_dd").firstChild, a), document.getElementById("_el_input_expirationboth") && l(document.getElementById("_el_input_expirationboth").firstChild, a), document.getElementById("_el_label_expiration") && l(document.getElementById("_el_label_expiration").firstChild, a), document.getElementById("_el_error_expiration") && l(document.getElementById("_el_error_expiration").firstChild, a), n) {
                    if (document.getElementById("_el_label_expiration")) {
                        var v = document.getElementById("_el_label_expiration");
                        i = v.offsetTop + v.getBoundingClientRect().height / 2
                    }
                    if (document.getElementById("_el_error_expiration")) {
                        var W = document.getElementById("_el_error_expiration");
                        W.style.setProperty("top", Math.abs(parseFloat(i) - parseFloat(W.getBoundingClientRect().height / 2)) + "px", "important")
                    }
                }
            } else if ("cvc" == s && Worldpay._shouldCheckFields.cvc) {
                if (document.getElementById("_el_error_cvc") && (document.getElementById("_el_error_cvc").style.display = "block"), document.getElementById("_el_input_cvc") && (l(document.getElementById("_el_input_cvc").firstChild, a), document.getElementById("_el_label_cvc") && l(document.getElementById("_el_label_cvc").firstChild, a), document.getElementById("_el_error_cvc") && l(document.getElementById("_el_error_cvc").firstChild, a)), n) {
                    if (document.getElementById("_el_label_cvc")) {
                        var _;
                        i = (_ = document.getElementById("_el_label_cvc")).offsetTop + _.getBoundingClientRect().height / 2
                    }
                    var C;
                    if (document.getElementById("_el_error_cvc"))(C = document.getElementById("_el_error_cvc")).style.setProperty("top", Math.abs(parseFloat(i) - parseFloat(C.getBoundingClientRect().height / 2)) + "px", "important")
                }
            } else "other" == s && document.getElementById("payment-errors") && (document.getElementById("payment-errors").style.display = "block", document.getElementById("payment-errors").innerHTML = t.error.object[p].other);
            else d(t.error.message);
            else d(t.error);
            window.parent.postMessage(Worldpay.helpers.JSON.stringify({
                errors: !0
            }), "*")
        }
    }, Worldpay.helpers.capitaliseFirstLetter = function (e) {
        return e ? e.charAt(0).toUpperCase() + e.slice(1) : ""
    }, Worldpay.helpers.ajax = {}, Worldpay.helpers.ajax.x = function (e, t) {
        var r = new XMLHttpRequest;
        return "withCredentials" in r ? r.open(e, t, !0) : "undefined" != typeof XDomainRequest ? (r = new XDomainRequest).open(e, t) : r = null, r
    }, Worldpay.helpers.ajax.send = function (e, l, n, t) {
        try {
            var r = function () {
                var o = new XDomainRequest;
                o.open("POST", e), o.onload = function () {
                    var e = o.responseText;
                    try {
                        var t = 200,
                            r = {};
                        if ("PUT" == n.toUpperCase()) t = 200;
                        else {
                            var a = Worldpay.helpers.JSON.parse(e);
                            r = a.customCode && "" != a.customCode ? {
                                error: {
                                    message: a.message,
                                    customCode: a.customCode
                                }
                            } : a, a.token || (t = 400)
                        }
                        l(t, r)
                    } catch (e) {
                        l(400, Worldpay.helpers.JSON.parse('{"error":"Failed to process card, please check your details."}'))
                    }
                }, o.onerror = function () {
                    "PUT" == n.toUpperCase() ? l(400, {
                        error: {
                            customCode: "BAD_REQUEST",
                            message: "CVC is invalid"
                        }
                    }) : l(400, Worldpay.helpers.JSON.parse('{"error":"Failed to process card, please check your details."}'))
                }, o.onprogress = function () {}, o.ontimeout = function () {
                    l(408, Worldpay.helpers.JSON.parse('{"error":"Processing card timed out, please try again."}'))
                }, setTimeout(function () {
                    o.send(t)
                }, 500)
            };
            if (window.XMLHttpRequest) {
                var o = new XMLHttpRequest;
                "withCredentials" in o ? (o.onreadystatechange = function () {
                    if (o.readyState && 4 === o.readyState) {
                        var e = o.responseText ? o.responseText : "{}";
                        try {
                            var t = Worldpay.helpers.JSON.parse(e),
                                r = t.customCode && "" != t.customCode ? {
                                    error: {
                                        message: t.message,
                                        customCode: t.customCode
                                    }
                                } : t,
                                a = 200;
                            t.token || (a = "PUT" == n.toUpperCase() ? o.status && 0 != parseInt(o.status) ? o.status : t.customCode && "" != t.customCode ? 400 : 200 : 400), l(a, r)
                        } catch (e) {
                            l(o.status || 400, Worldpay.helpers.JSON.parse('{"error":"' + (o.statusText || "Could not connect to server") + '"}'))
                        }
                    }
                }, o.open(n, e, !0), o.setRequestHeader("Content-type", "application/json"), o.send(t)) : window.XDomainRequest && r()
            } else window.XDomainRequest && r()
        } catch (e) {
            l(400, Worldpay.helpers.JSON.parse('{"error":"Failed to process card, please check your details."}'))
        }
    }, Worldpay.helpers.ajax.post = function (e, t, r) {
        Worldpay.helpers.ajax.send(e, t, "POST", r)
    }, Worldpay.helpers.ajax.put = function (e, t, r) {
        Worldpay.helpers.ajax.send(e, t, "PUT", r)
    }, Worldpay.helpers.JSON = {}, Worldpay.helpers.JSON.stringify = function (e) {
        if (null != JSON && null != JSON.stringify) return JSON.stringify(e);
        var t = typeof e;
        if ("object" !== t || null === e) return "string" === t && (e = '"' + e + '"'), String(e);
        var r, a, o = [],
            l = e && e.constructor == Array;
        for (r in e) "string" === (t = typeof (a = e[r])) ? a = '"' + a + '"' : "object" === t && null !== a && (a = Worldpay.helpers.JSON.stringify(a)), o.push((l ? "" : '"' + r + '":') + String(a));
        return (l ? "[" : "{") + String(o) + (l ? "]" : "}")
    }, Worldpay.helpers.JSON.parse = function (str) {
        return null != JSON && null != JSON.parse ? JSON.parse(str) : ("" === str && (str = '""'), eval("var p=" + str + ";"), p)
    }, Worldpay.helpers.Object = {}, Worldpay.helpers.Object.keys = Object.keys || function (e) {
        var o = Object.prototype.hasOwnProperty,
            l = !{
                toString: null
            }.propertyIsEnumerable("toString"),
            n = ["toString", "toLocaleString", "valueOf", "hasOwnProperty", "isPrototypeOf", "propertyIsEnumerable", "constructor"],
            d = n.length;
        return function (e) {
            if ("object" != typeof e && ("function" != typeof e || null === e)) throw new TypeError("Object.keys called on non-object");
            var t, r, a = [];
            for (t in e) o.call(e, t) && a.push(t);
            if (l)
                for (r = 0; r < d; r++) o.call(e, n[r]) && a.push(n[r]);
            return a
        }
    }, Worldpay.helpers.on = function (e, t, r) {
        var a, o, l, n, d, u, i, p;
        if (void 0 !== e)
            if (e.length && "SELECT" != e.tagName)
                for (o = 0, n = e.length; o < n; o++) a = e[o], Worldpay.helpers.on(a, t, r);
            else {
                if (!t.match(" ")) return i = r, r = function (e) {
                    return e = Worldpay.helpers.normalizeEvent(e), i(e)
                }, e.addEventListener ? e.addEventListener(t, r, !1) : e.attachEvent ? (t = "on" + t, e.attachEvent(t, r)) : void(e["on" + t] = r);
                for (l = 0, d = (p = t.split(" ")).length; l < d; l++) u = p[l], Worldpay.helpers.on(e, u, r)
            }
    }, Worldpay.helpers.normalizeEvent = function (e) {
        var t;
        return null == (e = {
            which: null != (t = e).which ? t.which : void 0,
            target: t.target || t.srcElement,
            preventDefault: function () {
                return Worldpay.helpers.preventDefault(t)
            },
            originalEvent: t,
            data: t.data || t.detail
        }).which && (e.which = null != t.charCode ? t.charCode : t.keyCode), e
    }, Worldpay.helpers.val = function (e, t) {
        var r;
        return 1 < arguments.length ? e.value = t : "string" == typeof (r = e.value) ? r.replace(/\r/g, "") : null === r ? "" : r
    }, Worldpay.helpers.hasTextSelected = function (e) {
        var t;
        return null != e.selectionStart && e.selectionStart !== e.selectionEnd || !(null == ("undefined" != typeof document && null !== document && null != (t = document.selection) ? t.createRange : void 0) || !document.selection.createRange().text)
    }, Worldpay.helpers.preventDefault = function (e) {
        return "function" == typeof e.preventDefault ? void e.preventDefault() : e.returnValue = !1
    }, Worldpay.helpers.restrictNumeric = function (e) {
        var t;
        return !(!e.metaKey && !e.ctrlKey) || (32 === e.which ? e.preventDefault() : 0 === e.which || (e.which < 33 || (t = String.fromCharCode(e.which), /[\d\s]/.test(t) ? void 0 : e.preventDefault())))
    }, Worldpay.helpers.formatExpiry = function (e) {
        var t, r, a;
        return t = String.fromCharCode(e.which), /^\d+$/.test(t) ? (r = e.target, a = Worldpay.helpers.val(r) + t, /^\d$/.test(a) && "0" !== a && "1" !== a ? (e.preventDefault(), Worldpay.helpers.val(r, "0" + a + " / ")) : /^\d\d$/.test(a) ? (e.preventDefault(), Worldpay.helpers.val(r, a + " / ")) : void 0) : void 0
    }, Worldpay.helpers.formatForwardSlash = function (e) {
        var t, r;
        return "/" === String.fromCharCode(e.which) ? (t = e.target, r = Worldpay.helpers.val(t), /^\d$/.test(r) && "0" !== r ? Worldpay.helpers.val(t, "0" + r + " / ") : void 0) : void 0
    }, Worldpay.helpers.formatForwardExpiry = function (e) {
        var t, r, a;
        return t = String.fromCharCode(e.which), /^\d+$/.test(t) ? (r = e.target, a = Worldpay.helpers.val(r), /^\d\d$/.test(a) ? Worldpay.helpers.val(r, a + " / ") : void 0) : void 0
    }, Worldpay.helpers.formatForwardSlash = function (e) {
        var t, r;
        return "/" === String.fromCharCode(e.which) ? (t = e.target, r = Worldpay.helpers.val(t), /^\d$/.test(r) && "0" !== r ? Worldpay.helpers.val(t, "0" + r + " / ") : void 0) : void 0
    }, Worldpay.helpers.formatBackExpiry = function (e) {
        var t, r;
        if (!e.metaKey && (t = e.target, r = Worldpay.helpers.val(t), 8 === e.which && (null == t.selectionStart || t.selectionStart === r.length))) return /\d(\s|\/)+$/.test(r) ? (e.preventDefault(), Worldpay.helpers.val(t, r.replace(/\d(\s|\/)*$/, ""))) : /\s\/\s?\d?$/.test(r) ? (e.preventDefault(), Worldpay.helpers.val(t, r.replace(/\s\/\s?\d?$/, ""))) : void 0
    }, Worldpay.helpers.restrictExpiry = function (e, t) {
        var r, a;
        return a = e.target, r = String.fromCharCode(e.which), /^\d+$/.test(r) && !Worldpay.helpers.hasTextSelected(a) ? (Worldpay.helpers.val(a) + r).replace(/\D/g, "").length > t ? e.preventDefault() : void 0 : void 0
    }, Worldpay.helpers.restrictCombinedExpiry = function (e) {
        return Worldpay.helpers.restrictExpiry(e, 6)
    }, Worldpay.helpers.restrictMonthExpiry = function (e) {
        return Worldpay.helpers.restrictExpiry(e, 2)
    }, Worldpay.helpers.restrictYearExpiry = function (e) {
        return Worldpay.helpers.restrictExpiry(e, 4)
    }, Worldpay.helpers.outputDevError = function (e, t) {
        Worldpay.debug ? console.log("WorldpayJS: " + e + " - CODE: " + t) : console && console.log && console.log("WorldpayJS: " + t)
    }, Worldpay.helpers.cleanInput = function (e) {
        return e ? e = (e = e.trim()).toUpperCase() : ""
    }, Worldpay.helpers.addClass = function (e, t) {
        e && (e.classList ? e.classList.add(t) : e.className += " " + t)
    }, Worldpay.helpers.removeClass = function (e, t) {
        e && (e.classList ? e.classList.remove(t) : e.className = e.className.replace(new RegExp("(^|\\b)" + t.split(" ").join("|") + "(\\b|$)", "gi"), " "))
    }, Worldpay.apm = {}, Worldpay.apm.createToken = function (e, t) {
        var r = Worldpay.apm.createTokenValidate(e, t);
        if (0 != r) {
            var a = {
                reusable: Worldpay.reusable,
                paymentMethod: {
                    type: "APM",
                    apmName: r["apm-name"],
                    shopperCountryCode: r["country-code"],
                    apmFields: r["apm-fields"]
                },
                clientKey: Worldpay.clientKey
            };
            r["language-code"] && (a.shopperLanguageCode = r["language-code"]), Worldpay.helpers.ajax.post(Worldpay.api_path + "tokens", t, Worldpay.helpers.JSON.stringify(a))
        }
    }, Worldpay.apm.createTokenValidate = function (e, t) {
        for (var r = {
                "apm-fields": {}
            }, a = 0; a < e.length; a++) e[a].getAttribute("data-worldpay") ? r[e[a].getAttribute("data-worldpay")] = e[a].value : e[a].getAttribute("data-worldpay-apm") && (r["apm-fields"][e[a].getAttribute("data-worldpay-apm")] = e[a].value);
        var o = [];
        return r["apm-name"] = r["apm-name"] || "", r["country-code"] = r["country-code"] || "", Worldpay.apm.validateApmName(r["apm-name"]) || o.push({
            apmname: "APM name is not valid"
        }), Worldpay.apm.validateCountryCode(r["country-code"]) || o.push({
            countrycode: "Country code is not valid"
        }), o.length ? (t(501, Worldpay.helpers.createErrorResponse(o)), !1) : (t(200, Worldpay.helpers.createErrorResponse(o)), r)
    }, Worldpay.apm.validateExists = function (e) {
        return null !== e && "" !== e
    }, Worldpay.apm.validateApmName = function (e) {
        return null !== e && "" !== e
    }, Worldpay.apm.validateCountryCode = function (e) {
        return null !== e && "" !== e
    }, Worldpay.apm.validateIdealShopperBankCode = function (e) {
        if ("" === (e = Worldpay.helpers.cleanInput(e))) return !1;
        switch (e) {
            case "ABN_AMRO":
            case "ASN":
            case "ING":
            case "FRIESLAND":
            case "RABOBANK":
            case "SNS":
            case "SNS_REGIO":
            case "TRIODOS":
            case "VAN_LANSCHOT":
            case "KNAB":
            case "BUNQ":
                return !0
        }
        return !1
    }, Worldpay.apm.createTokenFromObject = function (e) {
        if (!e || "object" != typeof e) return Worldpay.helpers.outputDevError("Worldpay.createAPMToken No object found", "A01"), !1;
        var t = e.callback,
            r = !1,
            a = [];
        if (e.clientKey && Worldpay.setClientKey(e.clientKey), e.useReusableToken && (r = e.useReusableToken), "function" != typeof t) return Worldpay.helpers.outputDevError("Worldpay.createAPMToken No callback found", "A02"), !1;
        if (e.apmName = e.apmName || "", e.countryCode = e.countryCode || "", e.apmFields = e.apmFields || {}, Worldpay.apm.validateApmName(e.apmName) || a.push({
                apmname: "APM name is not valid"
            }), Worldpay.apm.validateCountryCode(e.countryCode) || a.push({
                countrycode: "Country code is not valid"
            }), "giropay" == e.apmName && (Worldpay.apm.validateExists(e.apmFields) && Worldpay.apm.validateExists(e.apmFields.swiftCode) || a.push({
                swiftCode: "Swift code is not valid"
            })), "ideal" == e.apmName && (Worldpay.apm.validateExists(e.apmFields) && Worldpay.apm.validateExists(e.apmFields.shopperBankCode) && Worldpay.apm.validateIdealShopperBankCode(e.apmFields.shopperBankCode) || a.push({
                shopperBankCode: "Bank code is not valid"
            })), a.length) return t(501, Worldpay.helpers.createErrorResponse(a)), !1;
        var o = {
            reusable: r,
            paymentMethod: {
                type: "APM",
                apmName: e.apmName,
                shopperCountryCode: e.countryCode,
                apmFields: e.apmFields
            },
            clientKey: Worldpay.clientKey
        };
        e.languageCode && (o.shopperLanguageCode = e.languageCode), Worldpay.helpers.ajax.post(Worldpay.api_path + "tokens", t, Worldpay.helpers.JSON.stringify(o))
    }, Worldpay.card = {}, Worldpay.card.updateToken = function (e, t, r) {
        for (var a = {}, o = 0; o < e.length; o++) e[o].getAttribute("data-worldpay") && (a[e[o].getAttribute("data-worldpay")] = e[o].value);
        a.cvc = a.cvc || "";
        var l = [];
        if (Worldpay.card.validateCVC(a.cvc) || l.push({
                cvc: "CVC is not valid"
            }), l.length) return r(501, Worldpay.helpers.createErrorResponse(l)), !1;
        var n = {
            clientKey: Worldpay.clientKey,
            cvc: a.cvc
        };
        Worldpay.helpers.ajax.put(Worldpay.api_path + "tokens/" + t, r, Worldpay.helpers.JSON.stringify(n))
    }, Worldpay.card.createToken = function (e, t) {
        var r = Worldpay.card.createTokenValidate(e, t);
        if (0 != r) {
            var a = {
                reusable: Worldpay.reusable,
                paymentMethod: {
                    type: "Card",
                    name: r.name,
                    expiryMonth: r["exp-month"],
                    expiryYear: r["exp-year"],
                    cardNumber: r.number,
                    cvc: r.cvc
                },
                clientKey: Worldpay.clientKey
            };
            r["language-code"] && (a.shopperLanguageCode = r["language-code"]), Worldpay.helpers.ajax.post(Worldpay.api_path + "tokens", t, Worldpay.helpers.JSON.stringify(a))
        }
    }, Worldpay.card.createTokenValidate = function (e, t) {
        for (var r = {}, a = 0; a < e.length; a++) e[a].getAttribute("data-worldpay") && ("number" === e[a].getAttribute("data-worldpay") && (e[a].value = Worldpay.card.stripCardNumber(e[a].value)), r[e[a].getAttribute("data-worldpay")] = e[a].value);
        if (r["exp-monthyear"]) {
            if (r["exp-monthyear"].indexOf("/")) {
                var o = r["exp-monthyear"].split("/");
                o[0] && o[1] ? (r["exp-month"] = r["exp-monthyear"].split("/")[0].replace(" ", ""), r["exp-year"] = r["exp-monthyear"].split("/")[1].replace(" ", "")) : (r["exp-month"] = "", r["exp-year"] = "")
            }
            6 == r["exp-monthyear"].length && (r["exp-month"] = r["exp-monthyear"].substr(0, 2), r["exp-year"] = r["exp-monthyear"].substr(2))
        }
        r.name = r.name || "", r.number = r.number || "", r["exp-month"] = r["exp-month"] || "", r["exp-year"] = r["exp-year"] || "", r.cvc = r.cvc || "";
        var l = [];
        return Worldpay.card.validateExpiry(r["exp-month"], r["exp-year"]) || l.push({
            expiration: "Card Expiry is not valid"
        }), "basic" == Worldpay.validationType ? Worldpay.card.validateCardNumberBasic(r.number) || l.push({
            cardnumber: "Card Number is not valid"
        }) : "advanced" == Worldpay.validationType ? Worldpay.card.validateCardNumberAdvanced(r.number) || l.push({
            cardnumber: "Card Number is not valid"
        }) : l.push({
            other: "Invalid validation type"
        }), Worldpay.card.validateCardHolderName(r.name) || l.push({
            nameoncard: "Name on card is not valid"
        }), Worldpay.card.validateCVC(r.cvc) || l.push({
            cvc: "CVC is not valid"
        }), l.length ? (t(501, Worldpay.helpers.createErrorResponse(l)), !1) : (t(200, Worldpay.helpers.createErrorResponse(l)), r)
    }, Worldpay.card.reuseToken = function (e, t, r) {
        for (var a = {}, o = 0; o < e.length; o++) e[o].getAttribute("data-worldpay") && (a[e[o].getAttribute("data-worldpay")] = e[o].value);
        a.cvc = a.cvc || "", a.token = a.token || r || "";
        var l = [];
        if (Worldpay.card.validateCVC(a.cvc) || l.push({
                cvc: "CVC is not valid"
            }), "" == a.token && l.push({
                token: "Token can not be blank"
            }), l.length) return t(501, Worldpay.helpers.createErrorResponse(l)), !1;
        var n = {
            clientKey: Worldpay.clientKey,
            cvc: a.cvc
        };
        Worldpay.helpers.ajax.put(Worldpay.api_path + "tokens/" + a.token, t, Worldpay.helpers.JSON.stringify(n))
    }, Worldpay.card.stripCardNumber = function (e) {
        return (e = e.replace(/[\s]/g, "")).replace(/[-]/g, "")
    }, Worldpay.card.validateCardNumberBasic = function (e) {
        return null !== e && (!/[^0-9]+/.test(e) && "" !== e)
    }, Worldpay.card.validateCardNumberAdvanced = function (e) {
        if (null === e) return !1;
        if ("" === e) return !1;
        if (/[^0-9-\s]+/.test(e)) return !1;
        var t = e.split(" ").join("");
        if (t.length < 12 || 19 < t.length) return !1;
        for (var r = 0, a = 0, o = !1, l = (e = e.replace(/\D/g, "")).length - 1; 0 <= l; l--) {
            var n = e.charAt(l);
            a = parseInt(n, 10);
            o && 9 < (a *= 2) && (a -= 9), r += a, o = !o
        }
        return r % 10 == 0
    }, Worldpay.card.validateExpiry = function (e, t) {
        if (null === e || null === t || "" === e || "" === t) return !1;
        if (/[^0-9]+/.test(e)) return !1;
        if (/[^0-9]+/.test(t)) return !1;
        if (2 < e.length) return !1;
        if (4 < t.length || t.length < 4) return !1;
        t = t.toString();
        var r = (new Date).getMonth() + 1,
            a = (new Date).getFullYear().toString();
        return e = parseInt(e, 10), t = parseInt(t, 10), !isNaN(e) && !isNaN(t) && (!(12 < e || e < 1) && (a < t || t == a && r <= e))
    }, Worldpay.card.validateCVC = function (e) {
        return "" === e || (e || (e = ""), -1 === e.indexOf(" ") && (!/[^0-9]+/.test(e) && (1 != e.length && 2 != e.length)))
    }, Worldpay.card.validateCardHolderName = function (e) {
        return e || (e = ""), e = e.replace(new RegExp(" ", "g"), ""), /^[a-zA-Z'\-\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+$/.test(e)
    }, Worldpay.card.formatCardNumber = function (e) {
        var t, r, a, o, l, n, d;
        return r = String.fromCharCode(e.which), !/^\d+$/.test(r) || (l = e.target, d = Worldpay.helpers.val(l), t = Worldpay.card.cardFromNumber(d + r), a = (d.replace(/\D/g, "") + r).length, n = 16, t && (n = t.length[t.length.length - 1]), n <= a || null != l.selectionStart && l.selectionStart !== d.length) ? void 0 : (o = t && "amex" === t.type ? /^(\d{4}|\d{4}\s\d{6})$/ : /(?:^|\s)(\d{4})$/).test(d) ? (e.preventDefault(), Worldpay.helpers.val(l, d + " " + r)) : o.test(d + r) ? (e.preventDefault(), Worldpay.helpers.val(l, d + r + " ")) : void 0
    }, Worldpay.card.formatBackCardNumber = function (e) {
        var t, r;
        return t = e.target, r = Worldpay.helpers.val(t), e.meta || 8 !== e.which || null != t.selectionStart && t.selectionStart !== r.length ? void 0 : /\d\s$/.test(r) ? (e.preventDefault(), Worldpay.helpers.val(t, r.replace(/\d\s$/, ""))) : /\s\d?$/.test(r) ? (e.preventDefault(), Worldpay.helpers.val(t, r.replace(/\s\d?$/, ""))) : void 0
    }, Worldpay.card.restrictCardNumber = function (e) {
        var t, r, a, o;
        if (a = e.target, r = String.fromCharCode(e.which), /^\d+$/.test(r) && !Worldpay.helpers.hasTextSelected(a))
            if (o = (Worldpay.helpers.val(a) + r).replace(/\D/g, ""), t = Worldpay.card.cardFromNumber(o)) {
                if (!(o.length <= t.length[t.length.length - 1])) return e.preventDefault()
            } else if (!(o.length <= 16)) return e.preventDefault()
    }, Worldpay.card.formatCardNumberFromScratch = function (e) {
        var t, r, a, o;
        return (t = Worldpay.card.cardFromNumber(e)) ? (o = t.length[t.length.length - 1], e = (e = e.replace(/\D/g, "")).slice(0, +o + 1 || 9e9), t.format.global ? null != (a = e.match(t.format)) ? a.join(" ") : void 0 : (null != (r = t.format.exec(e)) && r.shift(), null != r ? r.join(" ") : void 0)) : ""
    }, Worldpay.card.reFormatCardNumber = function (r) {
        return setTimeout(function () {
            var e, t;
            return e = r.target, t = Worldpay.helpers.val(e), t = Worldpay.card.formatCardNumberFromScratch(t), Worldpay.helpers.val(e, t)
        })
    }, Worldpay.card.cardFromNumber = function (e) {
        var t, r, a;
        for (e = (e + "").replace(/\D/g, ""), r = 0, a = cardSettings.length; r < a; r++)
            if ((t = cardSettings[r]).pattern.test(e)) return t
    }, w.Worldpay = Worldpay
}(window);