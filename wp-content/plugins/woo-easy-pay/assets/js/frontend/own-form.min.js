jQuery(function(a){if("undefined"!=typeof worldpay_own_form_params){var n={vars:worldpay_own_form_params,cvc_selector:"#worldpay_cvc",payment_method_received:!1,cvc_received:!1,init:function(){if(this.gateway=this.vars.gateway,this.payment_type_selector='[name="'+this.gateway+'_payment_type_key"]',this.container="li.payment_method_"+this.gateway,this.nonce_selector="#"+this.gateway+"_payment_nonce",this.token_selector="#"+this.gateway+"_payment_token",this.$form=a(n.container).closest("form"),void 0===this.$form.attr("id")&&this.$form.attr("id","checkout-form"),this.cvc_required="1"===this.vars.cvc_required,this.has_saved_methods="1"===this.vars.has_saved_methods,a("form.checkout").on("checkout_place_order_"+this.gateway,this.process_order),a(document.body).on("updated_checkout",this.updated_checkout),a(document.body).on("click","#place_order",this.place_order),a(document.body).on("checkout_error",this.checkout_error),a(document.body).on("keyup",'[data-worldpay="number"]',this.update_card_type),a(document.body).on("worldpay_new_method_selected",this.new_method_selected),a(document.body).on("worldpay_saved_method_selected",this.saved_method_selected),a(document.body).on("worldpay_payment_method_changed",this.update_token_attribute),"undefined"!=typeof Worldpay&&Worldpay.card){var o=Worldpay.card.reuseToken;Worldpay.card.reuseToken=function(e,t,r){if(n.cvc_received)return!0;o&&o.call(Worldpay,e,t,r)};var r=Worldpay.card.createToken;Worldpay.card.createToken=function(e,t){if(n.payment_method_received)return!0;r&&r.call(Worldpay,e,t)}}this.initialize_form(),this.has_saved_methods&&this.initialize_cvv()},new_method_selected:function(){n.initialize_form()},saved_method_selected:function(){n.initialize_cvv()},initialize_form:function(){Worldpay.useOwnForm({clientKey:n.vars.client_key,form:n.$form[0],reusable:"1"===n.vars.reusable,formatCardNumber:!0,templateType:"card",cvc:!1,callback:function(e,t){t.error&&200!=e?n.submit_error(t.error):t.token&&(n.worldpay_form_function=n.$form.attr("onsubmit"),n.$form.attr("onsubmit",""),n.on_payment_nonce_received(t))}},a.extend(a(document.body).triggerHandler("worldpay_own_form_params",{})))},initialize_cvv:function(){n.cvc_required_for_vaulted()&&(Worldpay.setClientKey(n.vars.client_key),Worldpay.useOwnForm({clientKey:n.vars.client_key,form:n.$form[0],reusable:"1"===n.vars.reusable,templateType:"cvc",useReusableToken:!0,callback:function(e,t){t.error&&200!=e?n.submit_error(t.error):(n.worldpay_form_function=document.getElementById(n.$form.attr("id")).onsubmit,n.$form.attr("onsubmit",""),n.on_cvc_received(t))}}))},place_order:function(){n.is_gateway_selected()&&(a('[data-worldpay="name"]').val(a("#billing_first_name").val()+" "+a("#billing_last_name").val()),n.use_saved_card()?n.cvc_required&&n.initialize_cvv():n.initialize_form())},update_token_attribute:function(e,t){a(n.token_selector).attr("data-worldpay","token")},updated_checkout:function(){n.initialize_form(),n.has_saved_methods&&n.initialize_cvv()},process_order:function(){return n.use_saved_card()?!n.cvc_required||n.cvc_received:n.payment_method_received},on_payment_nonce_received:function(e){n.payment_method_received=!0,n.set_nonce(e.token),n.$form.submit()},on_cvc_received:function(e){n.cvc_received=!0,n.$form.submit()},set_nonce:function(e){a(n.nonce_selector).val(e)},is_gateway_selected:function(){return a('input[name="payment_method"]:checked').val()===n.gateway},checkout_error:function(){document.getElementById(n.$form.attr("id")).onsubmit=n.worldpay_form_function,n.payment_method_received=!1,n.cvc_received=!1,n.set_nonce(""),a('[data-worldpay="number"]').trigger("keypress")},submit_error:function(e){a(document.body).triggerHandler("worldpay_error_message_handler",{error:e,container:n.$form,gateway:n.gateway})},use_saved_card:function(){return a(n.payment_type_selector).length&&"token"===a(n.payment_type_selector+":checked").val()},update_card_type:function(e){var t,r=a(this).val();void 0!==(t=Worldpay.card.cardFromNumber(r))?a(".worldpay-card-type").attr("src",n.vars.cards[t.type]):a(".worldpay-card-type").attr("src",n.vars.cards.cc_format)},cvc_required_for_vaulted:function(){return n.cvc_required}};n.init()}});