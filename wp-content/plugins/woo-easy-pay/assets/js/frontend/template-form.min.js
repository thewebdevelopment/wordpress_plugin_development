jQuery(function(n){if("undefined"!=typeof worldpay_template_form_params){var o={vars:worldpay_template_form_params,gateway:worldpay_template_form_params.gateway,container:"li.payment_method_"+worldpay_template_form_params.gateway,payment_section:"worldpay_template_form_container",cvc_section:"worldpay_cvc_template_container",payment_method_received:!1,init:function(){this.gateway=this.vars.gateway,this.payment_type_selector='[name="'+this.gateway+'_payment_type_key"]',this.nonce_selector="#"+this.gateway+"_payment_nonce",this.token_selector="#"+this.gateway+"_payment_token",this.token_type_selector="#"+this.gateway+"_payment_token_type",this.cvc_required="1"===this.vars.cvc_required,n(document.body).on("updated_checkout",this.updated_checkout),n(document.body).on("checkout_error",this.checkout_error),n(document.body).on("click","#place_order",this.submit_template_form),n("form.checkout").on("checkout_place_order_"+o.gateway,this.process_order),this.$form=n(this.container).closest("form"),void 0===this.$form.attr("id")&&this.$form.attr("id","checkout-form"),n(document.body).on("worldpay_payment_method_changed",this.setup_cvc_template),n(document.body).on("worldpay_new_method_selected",this.initialize_card_frame),n(document.body).on("worldpay_saved_method_selected",this.setup_cvc_template);var a=Worldpay.helpers.templateFormCallback;Worldpay.helpers.templateFormCallback=function(e,t,o){a.call(Worldpay.helpers,e,t,o),t.token&&n(document.body).triggerHandler("worldpay_template_form_callback",[e,t,o])},this.initialize_card_frame()},updated_checkout:function(){o.has_saved_methods()||o.initialize_card_frame()},initialize_card_frame:function(){n("#"+o.payment_section).empty(),n("#"+o.cvc_section).empty(),Worldpay.useTemplateForm(o.get_card_template_attribs())},setup_cvc_template:function(e){n("#"+o.cvc_section).empty(),n("#"+o.payment_section).empty(),Worldpay.useTemplateForm(o.get_cvc_template_attribs())},get_card_template_attribs:function(){return{clientKey:o.vars.client_key,code:o.vars.form_template,form:o.$form.attr("id"),saveButton:!1,paymentSection:o.payment_section,display:"inline",reusable:"1"===o.vars.reusable,type:"card",templateOptions:{dimensions:{width:!1,height:!1}},callback:function(e){o.on_payment_nonce_received(e)},validationError:function(e){}}},get_cvc_template_attribs:function(e){var t={clientKey:o.vars.client_key,code:o.vars.cvc_template,token:n("#online_worldpay_token").val(),form:o.$form.attr("id"),paymentSection:o.cvc_section,display:"inline",type:"cvc",saveButton:!1,callback:function(e){o.on_cvc_token_received(e)},validationError:function(e){}};return""==o.vars.cvc_template&&(t.templateOptions={iframeHolderInline:"background-color: transparent;",dimensions:{width:"240px",height:"165px"},images:{enabled:!1}}),t},submit_template_form:function(e){o.gateway_selected()&&(o.use_saved_card()?o.cvc_required_for_vaulted()&&(e.preventDefault(),Worldpay.submitTemplateForm()):(e.preventDefault(),Worldpay.submitTemplateForm()))},on_payment_nonce_received:function(e){o.payment_method_received=!0,o.set_nonce(e.token),o.set_token_type(e.paymentMethod.type),n(o.container).closest("form").submit()},on_cvc_token_received:function(e){o.payment_method_received=!0,n(o.container).closest("form").submit()},process_order:function(){return!(!o.use_saved_card()||o.cvc_required_for_vaulted())||(o.cvc_required_for_vaulted(),o.payment_method_received)},nonce_available:function(){return""!==n(o.nonce_selector).val()},gateway_selected:function(){return n('input[name="payment_method"]:checked').val()===o.gateway},checkout_error:function(){n("#place_order").prop("disabled",!1),o.clear_nonce(),o.payment_method_received=!1},set_nonce:function(e){n(o.nonce_selector).val(e)},set_token_type:function(e){n(o.token_type_selector).val(e)},clear_nonce:function(){n(o.nonce_selector).val("")},has_checkout_error:function(){return 0<n("#owp_checkout_error").length},use_saved_card:function(){return n(o.payment_type_selector).length&&"token"===n(o.payment_type_selector+":checked").val()},has_saved_methods:function(){return 0<n(o.token_selector).length},cvc_required_for_vaulted:function(){return o.cvc_required},submit_error:function(e){n(document.body).triggerHandler("worldpay_error_message_handler",{error:e,container:o.$form,gateway:o.gateway})}};o.init()}});