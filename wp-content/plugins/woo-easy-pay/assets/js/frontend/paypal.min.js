jQuery(function(t){if("undefined"!=typeof worldpay_paypal_params){var n={params:worldpay_paypal_params,payment_nonce:"",payment_nonce_received:!1,init:function(){this.gateway=this.params.gateway,this.payment_type_selector='[name="'+this.gateway+'_payment_type_key"]',this.reusable="1"===this.params.reusable,this.container="li.payment_method_"+this.gateway,this.nonce_selector="#"+this.gateway+"_payment_nonce",this.token_selector="#"+this.gateway+"_payment_token",this.token_type_selector="#"+this.gateway+"_payment_token_type",this.$form=t(this.container).closest("form"),t("form.checkout").on("checkout_place_order_"+this.gateway,this.process_order),t(document.body).on("updated_checkout",this.updated_checkout),t(document.body).on("click","#place_order, .worldpay-paypal-button",this.place_order),t(document.body).on("checkout_error",this.checkout_error),t(document.body).on("click",".worldpay-paypal",this.place_order),t(document.body).on("worldpay_payment_method_selected",this.payment_gateway_selected),t(document.body).on("worldpay_new_method_selected",this.new_method_selected),t(document.body).on("worldpay_saved_method_selected",this.saved_method_selected),t(document.body).on("worldpay_template_form_callback",function(e,t,o){n.on_payment_nonce_received(o)}),this.create_button()},create_button:function(){n.$button&&n.$button.remove(),n.$button=t(n.params.button_html),n.$button.hide(),t("#place_order").parent().append(n.$button)},process_order:function(){return!!n.use_saved_card()||n.payment_nonce_received},on_payment_nonce_received:function(e){n.payment_nonce_received=!0,n.set_nonce(e.token),t(n.token_type_selector).val(e.paymentMethod.type),n.$form.submit()},updated_checkout:function(){n.create_button(),n.payment_gateway_selected()},place_order:function(){t('[data-worldpay="country-code"]').val(t("#billing_country").val()),n.prepare_form(),n.$form.submit()},prepare_form:function(){n.is_gateway_selected()&&!n.use_saved_card()&&(Worldpay.tokenType="apm",Worldpay.setClientKey(n.params.client_key),Worldpay.reusable=!0,Worldpay.useForm(n.$form[0],function(e,t){t.error&&200!=e?n.submit_error(t.error):t.token&&(n.worldpay_form_function=document.getElementById(n.$form.attr("id")).onsubmit,n.$form.attr("onsubmit",""),n.on_payment_nonce_received(t))}))},set_nonce:function(e){t(n.nonce_selector).val(e)},checkout_error:function(){Worldpay.tokenType="",t("#place_order").prop("disabled",!1),n.payment_nonce="",n.set_nonce(""),n.payment_nonce_received=!1},submit_error:function(e){t(document.body).triggerHandler("worldpay_error_message_handler",{error:e,container:n.$form,gateway:n.gateway})},use_saved_card:function(){return t(n.payment_type_selector).length&&"token"===t(n.payment_type_selector+":checked").val()},is_gateway_selected:function(){return t('[name="payment_method"]:checked').val()===n.gateway},payment_gateway_selected:function(){$button=t("#place_order"),n.is_gateway_selected()?n.use_saved_card()||n.payment_nonce_received?(n.$button.hide(),$button.show()):(n.$button.show(),$button.hide()):(n.$button.hide(),$button.show())},new_method_selected:function(){n.payment_gateway_selected()},saved_method_selected:function(){n.$form.attr("onsubmit",""),n.payment_gateway_selected()}};n.init()}});